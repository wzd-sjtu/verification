clear;
clc;
%第五组，张钧铎，姜冠宇，韩霄，牛博

%  感觉这个人写的好水！

yuantu=imread('7.jpg');%读取验证码
huid=rgb2gray(yuantu);%灰度化
%二值化
huid(huid>140)=255; %大于140白色，小于140黑色
huid(huid<140)=0;

%标准数字像素点
bz=zeros(12,9,10); 
bz1=zeros(12,9);
jieguo=zeros(1,4);
%0
bz(:,:,1)=[1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];
%1
bz(:,:,2)=[1     1     1     0     0     1     1     1     1;
         1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     1     1     1     1;
         0     0     0     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;];
%2 
bz(:,:,3)=[1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     0     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         1     1     1     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1;
         1     0     0     0     1     1     1     1     1;
         1     0     0     1     1     1     1     1     1;
         0     0     0     0     0     0     0     1     1;
         0     0     0     0     0     0     0     1     1];
%3
bz(:,:,4)=[1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     1     1     1     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         1     1     1     0     0     0     1     1     1;
         1     1     1     0     0     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         0     1     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];
%4
bz(:,:,5)=[1    1     1     1     1     0     0     1     1;
            1    1     1     1     0     0     0     1     1;
            1    1     1     1     0     0     0     1     1;
            1    1     1     0     0     0     0     1     1;
            1    1     0     0     0     0     0     1     1;
            1    0     0     0     1     0     0     1     1;
            1    0     0     1     1     0     0     1     1;
            0	 0     1     1     1     0     0     1     1;
            0	 0     0     0     0     0     0     0     1;
            0	 0     0     0     0     0     0     0     1;
            1	 1     1     1     1     0     0     1     1;
            1	 1     1     1     1     0     0     1     1];
%5
bz(:,:,6)=[1     1     0     0     0     0     0     1     1;
         1     0     0     0     0     0     0     1     1;
         0     0     0     1     1     1     1     1     1;
         0     0     0     1     1     1     1     1     1;
         0     0     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     1     1     1     0     0     1     1;
         1     1     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     0     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];
%6
bz(:,:,7)=[ 1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         1     0     1     1     1     0     0     1     1;
         0     0     1     1     1     1     1     1     1;
         0     0     0     0     0     0     1     1     1;
         0     0     0     0     0     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];
%7
bz(:,:,8)=[ 0     0     0     0     0     0     0     1     1;
         0     0     0     0     0     0     0     1     1;
         1     1     1     1     0     0     0     1     1;
         1     1     1     1     0     0     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     0     1     1     1     1;
         1     1     1     0     1     1     1     1     1;
         1     1     0     0     1     1     1     1     1;
         1     1     0     0     1     1     1     1     1;
         1     1     0     0     1     1     1     1     1;
         1     1     0     0     1     1     1     1     1;
         1     1     0     0     1     1     1     1     1];
%8
bz(:,:,9)=[ 1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     0     0     0     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];
%9
bz(:,:,10)=[1     1     0     0     0     1     1     1     1;
         1     0     0     0     0     0     1     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     0     1     1;
         1     1     0     0     0     0     0     1     1;
         0     1     1     1     1     0     0     1     1;
         0     0     1     1     1     0     0     1     1;
         1     0     0     0     0     0     1     1     1;
         1     1     0     0     0     1     1     1     1];

[m,n]=size(huid);
[m0,n0]=size(bz1);
xg=zeros(m-m0+1,n-n0+1,10);
aaa=zeros(4,10);

%计算相关性
for kk=1:10

    bz1=bz(:,:,kk);
    vec_sub=double(bz1(:));  
    norm_sub=norm(vec_sub);  
    for i=1:m-m0+1  
        for j=1:n-n0+1
            sm=huid(i:i+m0-1,j:j+n0-1);
            vv=double(sm(:));
            xg(i,j,kk)=vv'*vec_sub/(norm(vv)*norm_sub+eps);%归一化
        end  
    end  

% max(xg(:,:,kk));
end
px=sort(xg(:),'descend');%对相关系数排序

%相关系数较高的记为
pdj=0;
jj=0;
while pdj<4
	pdj=pdj+1;
    jj=jj+1;
[~,yy1,s1]=ind2sub(size(xg),find(xg==px(jj)));

f=1;
for ii1=1:pdj
    for ii2=1:10
        if abs(yy1-aaa(ii1,ii2))<3
        pdj=pdj-1;
        f=0;
        end
    end
end
if f==1
    aaa(pdj,s1)=yy1;
end
    
end
aaa
pxa=sort(aaa(:),'descend');

for jj=1:4
[xx1,yy1]=find(aaa==pxa(jj));
jieguo(5-jj)=yy1-1;
end
jieguo

imshow(yuantu);%显示原始图片
title({'识别结果',jieguo}); %显示结果

